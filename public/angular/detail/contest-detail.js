// Generated by CoffeeScript 1.9.3
(function() {
  'use script';
  this.angular.module('contest-detail', []).filter('marked', [
    '$sce', function($sce) {
      return function(text) {
        if (!text) {
          text = "";
        }
        return $sce.trustAsHtml(marked(text));
      };
    }
  ]).controller('contest-detail', [
    '$scope', '$routeParams', '$http', "$timeout", function($scope, $routeParams, $http, $timeout) {
      var contestPoller, rankPoller, subPoller;
      $scope.contest = {
        title: "Waiting for data...",
        description: "Waiting for data..."
      };
      $scope.idToOrder = {};
      contestPoller = function() {
        return $http.get("/api/contest/" + $routeParams.contestId).then(function(res) {
          var contest, i, j, len, p, ref;
          contest = res.data;
          contest.problems.sort(function(a, b) {
            return a.contest_problem_list.order - b.contest_problem_list.order;
          });
          ref = contest.problems;
          for (i = j = 0, len = ref.length; j < len; i = ++j) {
            p = ref[i];
            p.test_setting = JSON.parse(p.test_setting);
            $scope.idToOrder[p.id] = i;
          }
          return $scope.contest = contest;
        }, function() {
          return $timeout(contestPoller, Math.random() * 10000);
        });
      };
      contestPoller();
      $scope.rank = [];
      rankPoller = function() {
        return $http.get("/api/contest/" + $routeParams.contestId + "/rank").then(function(res) {
          $scope.rank = JSON.parse(res.data);
          return $timeout(rankPoller, 5000 + Math.random() * 5000);
        }, function() {
          return $timeout(rankPoller, Math.random() * 10000);
        });
      };
      rankPoller();
      $scope.submissions = [];
      subPoller = function() {
        return $http.get("/api/contest/" + $routeParams.contestId + "/submission").then(function(res) {
          $scope.submissions = res.data;
          return $timeout(subPoller, 1000 + Math.random() * 1000);
        }, function() {
          return $timeout(subPoller, Math.random() * 5000);
        });
      };
      subPoller();
      $scope.page = "description";
      $scope.order = 0;
      $scope.setPage = function(page) {
        return $scope.page = page;
      };
      $scope.isPage = function(page) {
        return page === $scope.page;
      };
      $scope.setProblem = function(order) {
        $scope.order = order;
        return $timeout(function() {
          return MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }, 500);
      };
      $scope.isProblem = function(order) {
        return $scope.order === order;
      };
      return $scope.numberToLetters = function(num) {
        var res;
        if (num === 0) {
          return 'A';
        }
        res = "";
        while (num > 0) {
          res = String.fromCharCode(num % 26 + 65) + res;
          num = parseInt(num / 26);
        }
        return res;
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=contest-detail.js.map
