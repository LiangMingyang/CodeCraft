//
   Created by zp on 15-6-5.
extends ../layout
block title
    - var whichPage = "评测记录"
    if(contest)
        - var whichPage = "比赛提交记录"
    title #{whichPage}

block content
    include contest-title.jade
    - var oddEvenTable = "odd"
    - var colorOfTable = "red"
    - var yy;
    - var mm;
    - var dd;
    - var hh;
    - var mi;
    - var ss;
    - var changeSubmissionResult = {AC : "Accepted", WA : "Wrong Answer", CE : "Compile Error", RE : "Runtime Error", "REG" : "Runtime Error (SIGSEGV)", "REP" : "Runtime Error (SIGFPE)", WT : "Waiting", JG : "Running", TLE : "Time Limit Exceed", MLE : "Memory Limit Exceed", PE : "Presentation Error", ERR : "Judge Error", "IFNR" : "Input File Not Ready", "OFNR" : "Output File Not Ready", "EFNR" : "Error File Not Ready", "OE" : "Other Error"}
    .col-lg-2.col-md-2.col-sm-2
        include contest.jade
    .col-lg-8.col-md-8.col-sm-8
        h3 比赛所有提交记录
        table.table.table-condensed.table-center
            tr
                td 序号
                if(!problem)
                    td 题目
                td 结果
                td 得分
                td 语言
                td 代码长度
                td 运行时间
                td 运行内存
                td 提交时间
            if(submissions)
                - for (var i = 0 ;i < submissions.length ; i++)
                    tr(id = "tr" + i)
                        //在渲染前处理时间
                        - yy = submissions[i].created_at.getFullYear();
                        - mm = submissions[i].created_at.getMonth() - 0 + 1;
                        - if(mm<10)
                            - mm="0"+mm;
                        - dd = submissions[i].created_at.getDate();
                        - if(dd<10)
                            - dd="0"+dd;
                        - hh = submissions[i].created_at.getHours();
                        - if(hh<10)
                            - hh="0"+hh;
                        - mi = submissions[i].created_at.getMinutes();
                        - if(mi<10)
                            - mi="0"+mi;
                        - ss = submissions[i].created_at.getSeconds();
                        - if(ss<10)
                            - ss="0"+ss;
                        //生成表格
                        td #{submissions[i].id}
                        if(!problem)
                            td
                                a(href = "./problem/" + submissions[i].problem_order + "/index") #{submissions[i].problem_order}
                        td
                            label(id = "td" + i, onmouseover="showDetail(" + i + ")", onmouseout="hideDetail(" + i + ")", data-toggle="popover", data-trigger="focus", data-placement="bottom", data-content=submissions[i].detail) #{changeSubmissionResult[submissions[i].result]}
                        td #{submissions[i].score}
                        td
                            a(href='/submission/' + submissions[i].id, target="_blank") #{submissions[i].lang}
                        td
                            a(href='/submission/' + submissions[i].id, target="_blank") #{submissions[i].code_length}
                        td #{submissions[i].time_cost}
                        td #{submissions[i].memory_cost}
                        td #{yy}-#{mm}-#{dd} #{hh}:#{mi}:#{ss}
                        //td #{submissions[i].created_at.getFullYear()}-#{submissions[i].created_at.getMonth()-0+1}-#{submissions[i].created_at.getDate()} #{submissions[i].created_at.getHours()}:#{submissions[i].created_at.getMinutes()}:#{submissions[i].created_at.getSeconds()}
                        - if(i % 2 == 1)
                            - oddEvenTable = "odd"
                        - else
                            - oddEvenTable = "even"
                        - if(submissions[i].result == "AC")
                            - colorOfTable = "blue"
                        - else if(submissions[i].result == "WT" || submissions[i].result == "JG")
                            - colorOfTable = "green"
                        - else
                            - colorOfTable = "red"
                        script.
                            $("#tr#{i}").attr("class", "#{oddEvenTable}#{colorOfTable}tr");
                            $("#td#{i}").attr("class", "#{colorOfTable}td");
                            function showDetail(numi){
                                $("#td"+numi).popover('show');
                            }
                            function hideDetail(numi){
                                $("#td"+numi).popover('hide');
                            }
        .row
            .col-lg-12.col-md-12.col-sm-12
                - if(!pageLimit)
                    - pageLimit = 15;
                - if(!offset)
                    - offset = 0;
                - var prevOffset = offset - pageLimit;
                - if(prevOffset < 0)
                    - prevOffset = 0;
                - var nextOffset = offset - 0 + pageLimit;
                - if(offset>0)
                    a.button.btn.btn-default(href="./submission?offset=" + prevOffset) 上一页
                a.button.btn.btn-default(href="./submission") 首页
                - if(submissions.length == pageLimit)
                    a.button.btn.btn-default(href="./submission?offset=" + nextOffset) 下一页
    .col-lg-2.col-md-2.col-sm-2
        include time.jade
